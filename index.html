<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Subir Excel y Mostrar Códigos</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- XLSX Library CDN -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
</head>
<body class="bg-gray-100 min-h-screen flex items-center justify-center p-4">
    <div class="container max-w-4xl mx-auto bg-white p-6 rounded-lg shadow-lg">
        <h1 class="text-2xl font-bold text-gray-800 mb-4">Subir Excel y Mostrar Códigos</h1>
        
        <!-- Input para subir el archivo -->
        <div class="mb-4">
            <label class="block text-sm font-medium text-gray-700 mb-2" for="excelFile">Subir archivo Excel</label>
            <input type="file" id="excelFile" accept=".xls,.xlsx" class="block w-full text-sm text-gray-900 border border-gray-300 rounded-lg cursor-pointer bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-500">
        </div>

        <!-- Contenedor para mostrar los datos -->
        <div id="list" class="space-y-4"></div>

        <!-- Botón para guardar progreso -->
        <button id="saveButton" class="mt-4 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-green-500">Guardar Progreso</button>
    </div>

    <script>
        // Escuchar el evento de cambio en el input de archivo
        document.getElementById('excelFile').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const data = new Uint8Array(e.target.result);
                    const workbook = XLSX.read(data, { type: 'array' });
                    const sheetName = workbook.SheetNames[0];
                    const sheet = workbook.Sheets[sheetName];
                    const jsonData = XLSX.utils.sheet_to_json(sheet);

                    // Mostrar los datos
                    displayData(jsonData);
                };
                reader.readAsArrayBuffer(file);
            }
        });

        // Datos de ejemplo si no se sube un archivo (basado en lo que me diste)
        const sampleData = [
            { "CONSECUTIVO EN EL RUP": "N/A", "CONTRATANTE": "Departamento de Policía Guajira", "CODIGOS": "26111700 26121600 30101800 30102900 32101500 32101600 32111500 32111600 32111700 39121000 41113600 41113700 43191500 43191600 43221500 43221700 43222500 43222600 43222800 43232300 43232800 43232900 43233200 44103100 52161500 52161600 72103300 72141100 72151500 72151600 73152100 76101500 80111600 81101700 81111800 81112000 81112100 81112200 81161700 92101500 92121700 95121800" },
            { "CONSECUTIVO EN EL RUP": "N/A", "CONTRATANTE": "Policía Metropolitana San Jerónimo de Monteríra", "CODIGOS": "26111700 26121600 30101800 30102900 32101500 32101600 32111500 32111600 32111700 39121000 41113600 41113700 43191500 43191600 43221500 43221700 43222500 43222600 43222800 43232300 43232800 43232900 43233200 44103100 52161500 52161600 72103300 72141100 72151500 72151600 73152100 76101500 80111600 81101700 81111800 81112000 81112100 81112200 81161700 92101500 92121700 95121800" },
            { "CONSECUTIVO EN EL RUP": "N/A", "CONTRATANTE": "ESE Hospital San Pedro Claver de Mogotes Santander", "CODIGOS": "26111700 32101600 32131000 39121000 41112200 43201400 43201800 43201900 43211500 43211600 43211700 43212100 43221700 43221800 43223100 43233700 45121500 45121600 45131700 46171600 72151600 81111600 81161700 83112300" }
        ];

        // Función para mostrar los datos
        function displayData(data) {
            const list = document.getElementById('list');
            list.innerHTML = '';

            // Usar datos de ejemplo si no se sube archivo, o los datos del Excel
            const displayData = data.length > 0 ? data : sampleData;

            displayData.forEach(item => {
                const codes = item['CODIGOS'] ? item['CODIGOS'].split(' ') : []; // Separar por espacios
                const itemDiv = document.createElement('div');
                itemDiv.className = 'border border-gray-200 p-4 rounded-lg';
                itemDiv.innerHTML = `
                    <p class="text-sm text-gray-600"><strong>Consecutivo:</strong> ${item['CONSECUTIVO EN EL RUP'] || 'N/A'}</p>
                    <p class="text-sm text-gray-600"><strong>Contratante:</strong> ${item['CONTRATANTE'] || 'N/A'}</p>
                    <p class="text-sm text-gray-600"><strong>Códigos:</strong></p>
                    <div class="flex flex-wrap gap-2 mt-2"></div>
                `;

                const codesContainer = itemDiv.querySelector('div');
                codes.forEach(code => {
                    const codeSpan = document.createElement('span');
                    codeSpan.textContent = code;
                    codeSpan.className = 'inline-block px-3 py-1 bg-gray-200 text-gray-800 text-sm rounded-full cursor-pointer hover:bg-gray-300';
                    codeSpan.onclick = () => toggleHighlight(codeSpan);
                    codesContainer.appendChild(codeSpan);
                });

                list.appendChild(itemDiv);
            });

            // Cargar progreso guardado
            loadProgress();
        }

        // Función para resaltar o quitar resaltado
        function toggleHighlight(element) {
            element.classList.toggle('bg-yellow-300');
            element.classList.toggle('text-gray-900');
        }

        // Función para guardar el progreso
        document.getElementById('saveButton').addEventListener('click', function() {
            const items = document.querySelectorAll('#list span');
            const highlighted = [];
            items.forEach((item, index) => {
                if (item.classList.contains('bg-yellow-300')) {
                    highlighted.push(index);
                }
            });
            localStorage.setItem('highlightedCodes', JSON.stringify(highlighted));
            alert('Progreso guardado exitosamente');
        });

        // Función para cargar el progreso
        function loadProgress() {
            const saved = localStorage.getItem('highlightedCodes');
            if (saved) {
                const highlighted = JSON.parse(saved);
                const items = document.querySelectorAll('#list span');
                highlighted.forEach(index => {
                    if (items[index]) {
                        items[index].classList.add('bg-yellow-300', 'text-gray-900');
                    }
                });
            }
        }

        // Mostrar datos de ejemplo al cargar la página
        window.onload = () => displayData([]);
    </script>
</body>
</html>
